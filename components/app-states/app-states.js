!function(){var t=Object.create(HTMLElement.prototype);t.clearContent=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},t.isParentOf=function(t,e){for(var n=t.parentNode;n;){if(n===e)return!0;n=n.parentNode}return!1},t.directChildren=function(t,e){var n=Array.isArray(t)?t:[t],a=[];return[].forEach.call(n,function(t){[].forEach.call(t.children,function(t){t.tagName==e.toUpperCase()&&a.push(t)})}),a},t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.fireEvent=function(t,e,n){var a=document.createEvent("CustomEvent");return a.initCustomEvent(t,!1,!0,e),n.dispatchEvent(a)},t.buildUrl=function(t,e,n){var a,i="";if("pushstate"!=n&&"#"!=t[0]&&(i=""),a=i+t,e){var r=a.match(/:[a-zA-Z0-9%_]+/g)||[],s=[];r.forEach(function(t){var n=t.slice(1);"undefined"!=typeof e[n]&&(a=a.replace(t,encodeURIComponent(e[n])),s.push(n))});for(var o in e)s.indexOf(o)<0&&(a+=a.indexOf("?")<0?"?"+encodeURIComponent(o)+"="+encodeURIComponent(e[o]):"&"+encodeURIComponent(o)+"="+encodeURIComponent(e[o]))}return a},t.parseUrl=function(t,e){var n={isHashPath:"hash"===e};if("function"==typeof URL){var a=new URL(t);n.path=a.pathname,n.hash=a.hash,n.search=a.search}else{var i=document.createElement("a");i.href=t,n.path=i.pathname,"/"!==n.path.charAt(0)&&(n.path="/"+n.path),n.hash=i.hash,n.search=i.search}if("pushstate"!==e&&("#/"===n.hash.substring(0,2)?(n.isHashPath=!0,n.path=n.hash.substring(1)):"#!/"===n.hash.substring(0,3)?(n.isHashPath=!0,n.path=n.hash.substring(2)):n.isHashPath&&(n.path=0===n.hash.length?"/":n.hash.substring(1)),n.isHashPath)){n.hash="";var r=n.path.indexOf("#");-1!==r&&(n.hash=n.path.substring(r),n.path=n.path.substring(0,r));var s=n.path.indexOf("?");-1!==s&&(n.search=n.path.substring(s),n.path=n.path.substring(0,s))}return n},t.testRoute=function(t,e,n,a){return"ignore"===n&&("/"===e.slice(-1)&&(e=e.slice(0,-1)),"/"!==t.slice(-1)||a||(t=t.slice(0,-1))),a?this.testRegExString(t,e):t===e||"*"===t?!0:("/"!==t.charAt(0)&&(t="/**/"+t),this.segmentsMatch(t.split("/"),1,e.split("/"),1))},t.segmentsMatch=function(t,e,n,a,i){var r=t[e]||"",s=n[a]||"";if("**"===r&&e===t.length-1)return!0;if(""===r||""===s)return r===s;if(r===s||"*"===r||":"===r.charAt(0))return":"===r.charAt(0)&&"undefined"!=typeof i&&(i[r.substring(1)]=n[a]),this.segmentsMatch(t,e+1,n,a+1,i);if("**"===r)for(var o=a;o<n.length;o++)if(this.segmentsMatch(t,e+1,n,o,i))return!0;return!1},t.routeArguments=function(t,e,n,a,i){var r={};a||("/"!==t.charAt(0)&&(t="/**/"+t),this.segmentsMatch(t.split("/"),1,e.split("/"),1,r));var s=n.substring(1).split("&");1===s.length&&""===s[0]&&(s=[]);for(var o=0;o<s.length;o++){var h=s[o],c=h.split("=");r[c[0]]=c.splice(1,c.length-1).join("=")}if(i)for(var l in r)r[l]=this.typecast(r[l]);return r},t.typecast=function(t){return"true"===t?!0:"false"===t?!1:isNaN(t)||""===t||"0"===t.charAt(0)?decodeURIComponent(t):+t},t.testRegExString=function(t,e){if("/"!==t.charAt(0))return!1;t=t.slice(1);var n="";if("/"===t.slice(-1))t=t.slice(0,-1);else{if("/i"!==t.slice(-2))return!1;t=t.slice(0,-2),n="i"}return new RegExp(t,n).test(e)},document.registerElement("states-helper",{prototype:t})}(),function(){function t(t){this.name=t,this.internalCache={}}function e(e){var a=n[e];return a||(n[e]=a=new t(e)),a}t.prototype.get=function(t){return this.internalCache[t]},t.prototype.set=function(t,e){if(this.get(t))throw Error("Already have an id :"+t);this.internalCache[t]=e},t.prototype.del=function(t){if(!this.get(t))throw Error("Cannot delete a non-existing id :"+t);delete this.internalCache[t]},t.prototype.items=function(){return this.internalCache},t.prototype.itemsArray=function(){var t=[];for(var e in this.internalCache)t.push(this.internalCache[e]);return t};var n={},a=Object.create(HTMLElement.prototype);a.getCache=function(t){return e.call(this,t)},document.registerElement("view-registry",{prototype:a})}(),function(){function t(t,e){e.parentNode.insertBefore(t,e.nextSibling)}function e(t,e){e.parentNode.insertBefore(t,e)}function n(t,e){this.id=t,this.comment=e}n.prototype.place=function(e){t(e,this.comment),this.content=e},n.prototype.remove=function(){var t=this.content.templateInstance,e=t.firstNode;if(e)if(t.firstNode==t.lastNode)this.comment.parentNode.removeChild(e);else{for(;e&&e!=t.lastNode;){var n=e;e=e.nextSibling,this.comment.parentNode.removeChild(n)}this.comment.parentNode.removeChild(t.lastNode)}delete this.content},!function(){var t=window.MutationObserver||window.WebKitMutationObserver,e=window.addEventListener;return function(n,a){if(t){var i=new t(function(t){(t[0].addedNodes.length||t[0].removedNodes.length)&&a()});i.observe(n,{childList:!0,subtree:!0})}else e&&(n.addEventListener("DOMNodeInserted",a,!1),n.addEventListener("DOMNodeRemoved",a,!1))}}(),Polymer("place-holder",{created:function(){if(!this.hasAttribute("id"))throw Error("place-holder should vahe a unique id");if(this.cache=document.createElement("view-registry").getCache("place-holder:id"),"comment"==this.getAttribute("renderAs")){var t=document.createComment("place-holder:"+this.id),a=new n(this.id,t);t.holder=a,this.cache.set("#"+this.id,a),e(t,this),this.parentNode.removeChild(this)}else this.cache.set("#"+this.id,this)},attached:function(){},detached:function(){"comment"!=this.getAttribute("renderAs")&&this.cache.del("#"+this.id)},place:function(e){t(e,this),this.content=e,console.log("Holder content placed: "+this.id)},remove:function(){var t=this.content.templateInstance,e=t.firstNode;if(e)if(t.firstNode==t.lastNode)this.parentNode.removeChild(e);else{for(;e&&e!=t.lastNode;){var n=e;e=e.nextSibling,this.parentNode.removeChild(n)}this.parentNode.removeChild(t.lastNode)}delete this.content}})}(),function(){Polymer("state-view",{getHolder:function(){var t=this.holderCache.get(this.target);if(!t)throw Error("state-view: Cannot locate target:"+this.target);return t},attached:function(){this.holderCache=document.createElement("view-registry").getCache("place-holder:id"),this.cache=document.createElement("view-registry").getCache("state-view:target");var t=this.cache.get(this.target);t?t.push(this):this.cache.set(this.target,[this])},detached:function(){delete this.instance;var t=this.cache.get(this.target);t&&t.length&&t.indexOf(this)>=0&&t.splice(t.indexOf(this),1)},changeModel:function(t){var e=this.instance.templateInstance.model;for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},clearContent:function(){if(this.instance){var t=this.getHolder();t.remove(),delete this.instance}},loadInto:function(t,e){var n=this.cache.get(this.target);n.forEach(function(t){this!=t&&t.instance&&t.target!=this.virtualHolder&&t.clearContent()}.bind(this)),t.content&&t.remove();var a=this.createInstance(e);this.instance=a,t.place(a)},loadContent:function(t){if(this.instance)throw Error("Virtual view already loaded. Clear first.");var e=this.getHolder();this.loadInto(e,t)}})}(),function(){function t(t,e,n){var a=[];return e.forEach(function(e){t.forEach(function(t){t.forEach(function(t){t.parentNode===e&&a.push(n?n(t):t)})})}),a}function e(t,e){e=e||[];var n=function(t){for(var e=t.nextElementSibling;e;)"APP-STATE"==e.tagName&&e.loaded&&e.unLoad(),e=e.nextElementSibling;for(var n=t.previousElementSibling;n;)"APP-STATE"==n.tagName&&n.loaded&&n.unLoad(),n=n.previousElementSibling},a=t.parentNode;for(e.splice(0,0,t);a&&"APP-STATE"===a.tagName;)e.splice(0,0,a),n(a),a=a.parentNode;n(t);var i=t.querySelectorAll("app-state");[].map.call(i,function(t){t&&"APP-STATE"==t.tagName&&t.loaded&&t.unLoad()})}function n(e,n,a){var i=function(t,e,n){for(var a=e.map(function(t){return t.target}),i=n.map(function(t){return t.target}),r=t.loaded,s=0;s<a.length;s++){var o=e[s];i.indexOf(a[s])<0&&(r?("undefined"!=typeof t.forceReload&&(t.unLoad(),r=!1),o.instance?o.changeModel(t.getModel()):o.loadContent(t.getModel())):o.loadContent(t.getModel()))}r||(t.loaded=!0,console.log("State loaded:"+(t.id||t.header||"anonymous")))};a=a||[];for(var r=0;r<e.length;r++){var s=e[r],o=t(n,[s]),h=t(n,e.slice(r+1));i.call(this,s,o,h)}}Polymer("app-state",{get parentState(){for(var t=this.parentNode;t;){if("APP-STATE"==t.tagName)return t;t=t.parentNode}},getStateManager:function(){for(var t=this.parentNode;t;){if("APP-STATE-MANAGER"==t.tagName)return t;t=t.parentNode}},created:function(){this.stateViewCache=document.createElement("view-registry").getCache("state-view:target")},ready:function(){if(this.hasAttribute("childStates")){var t=this.getAttribute("childStates");if("undefined"!=typeof t){var e=document.createElement(t),n=this.$.helper.directChildren(e.shadowRoot,"app-state");n.forEach(function(t){this.appendChild(t)}.bind(this))}}},attached:function(){this.stateManager=this.getStateManager(),this.stateManager||(this.stateManager=document.querySelector("body /deep/ app-state-manager"))},getModel:function(){for(var t=this.stateManager.parseUrl(),e=this.$.helper.routeArguments(this.url,t.path,t.search,this.regex,"auto"===this.stateManager.typecast),n=this.model,a=this.parentNode;!n&&a&&("APP-STATE"==a.tagName||"APP-STATE-MANAGER"==a.tagName);)n=a.model,a=a.parentNode;if(n&&n!==this.model){var i=Object.create(n);n=i}return{model:n,urlParams:e,state:this}},load:function(){if(this.hasAttribute("redirect"))return this.stateManager.go(this.getAttribute("redirect"),{replace:!0}),void 0;var t=[];e(this,t),n.call(this,t,this.stateViewCache.itemsArray())},buildUrl:function(t){return this.$.helper.buildUrl(this.url,t,this.stateManager.mode)},unLoad:function(){for(var e=this,n=this.children[0];n;)"APP-STATE"==n.tagName&&n.loaded&&n.unLoad(),n=n.nextElementSibling;var a=this.stateViewCache.itemsArray();t(a,[e],function(t){return t.clearContent(),t}),delete e.loaded,console.log("State unloaded: "+(e.id||e.header||"anonymous"))}})}(),function(){function t(e,n){var a=e.url;"undefined"==typeof a&&(e.url=e.urlPostfix?e.parentState.url+e.urlPostfix+"/":n,a=n);for(var i=e.children[0];i;)"APP-STATE"==i.tagName&&t(i,a+i.id+"/"),i=i.nextElementSibling}var e="ActiveXObject"in window,n={};Polymer("app-state-manager",{matchState:function(t){"string"==typeof t&&(t=this.$.helper.parseUrl(t,this.mode));for(var e,n=this.querySelectorAll("app-state"),a=0;a<n.length;a++){var i=n[a];if(this.$.helper.testRoute(i.url,t.path,this.trailingSlash,i.regex)){e=i;break}}var r={match:e};return this.$.helper.fireEvent("state-match",r,this),r.match},getStateById:function(t){return this.querySelector("#"+t)},gotoState:function(t){if("string"==typeof t){var e=this.getStateById(t);if(!e)throw Error("unable to locate state:"+t);t=e}var n={from:this.currentState,to:t};if(this.$.helper.fireEvent("state-changing",n,this)){t.load(),this.oldState=this.currentState,this.currentState=t;var a={oldState:this.oldState,currentState:t};this.$.helper.fireEvent("state-changed",a,this),this.$.helper.fireEvent("app-state-changed",a,document)}},go:function(t,e){"pushstate"!==this.mode&&(t="#"+t),e&&e.replace===!0?window.history.replaceState(null,null,t):window.history.pushState(null,null,t);try{var n=new PopStateEvent("popstate",{bubbles:!1,cancelable:!1,state:{}});"dispatchEvent_"in window?window.dispatchEvent_(n):window.dispatchEvent(n)}catch(a){var i=document.createEvent("CustomEvent");i.initCustomEvent("popstate",!1,!1,{state:{}}),window.dispatchEvent(i)}},parseUrl:function(t,e){return t=t||window.location.href,e=e||this.mode,this.$.helper.parseUrl(t,e)},created:function(){window.appStateManager=window.appStateManager||this},urlChangeHandler:function(){var t=this.parseUrl();if(t.hash!==n.hash&&t.path===n.path&&t.search===n.search&&t.isHashPath===n.isHashPath)return this.scrollToHash(t.hash),void 0;var e=this.matchState(t);if(e&&"undefined"!=typeof e.forceReload);else if(n.isHashPath===t.isHashPath&&n.hash===t.hash&&n.path===t.path&&n.search===t.search)return;n=t;var a={url:t};if(this.$.helper.fireEvent("url-change",a,this)){var i=this.matchState(t);i&&this.gotoState(i)}},scrollToHash:function(t){t&&setTimeout(function(){var e=document.querySelector("html /deep/ "+t)||document.querySelector('html /deep/ [name="'+t.substring(1)+'"]');e&&e.scrollIntoView&&e.scrollIntoView(!0)},0)},init:function(){this.isInited||(this.isInited=!0,this.mode=this.mode||"auto",this.trailingSlash=this.trailingSlash||"strict",this.typecast=this.typecast||"auto",window.addEventListener("popstate",this.urlChangeHandler.bind(this),!1),e&&window.addEventListener("hashchange",this.router.urlChangeHandler.bind(this),!1),this.urlChangeHandler(),this.$.helper.fireEvent("states-inited",{},this))},domReady:function(){"manual"!==this.getAttribute("init")&&this.init()},ready:function(){var e=this.root=this.querySelector("app-state:first-child");e&&t.call(this,e,"/")},detached:function(){window.removeEventListener("popstate",this.stateChangeHandler,!1),e&&window.removeEventListener("hashchange",this.stateChangeHandler,!1)}})}();