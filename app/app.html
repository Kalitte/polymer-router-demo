<link rel="import" href="ref.html">

<polymer-element name="my-app" class="app">
  <template>


    <app-state-manager id="stateManager"  mode="hash">

      <app-state id="root" header="Home" bindModel="{{ stateModelBase }}" bindState bindUrlParams>
        <template is="state-view" target="#navheader-toolbar">
            <span>username</span>
            <span>email</span>
            </div>
        </template>

        <template is="state-view" target="#side">
            <app-states-menu ignoreAttr="ignoreMenu"></app-states-menu>
        </template>

        <template is="state-view" target="#main" bindModel="{{ {Hi:12}  }}">
          <home-page Hi="{{ Hi }}"></home-page>
        </template>

        <app-state id="articles" urlPostfix="articles" header="Articles" bindModelAs="data" bindModel="{{ articles }}"  childStates="article-states">
          <template is="state-view" target="#main">
            <articles-home articles="{{ data }}"></articles-home>
          </template>
        </app-state>

        <app-state id="account" header="Account" childStates="account-states">
          <template is="state-view" target="#main">
              <account-home></account-home>
          </template>

          <template is="state-view" target="#navheader-toolbar" class="account">
              <h2>{{ model.stateManager.id }}</h2>

              <br>
              <span>Call ...</span>
          </template>
        </app-state>

        <app-state url="*" ignoreMenu header="Not Found">
          <template is="state-view" target="#main">
            <n404-page></n404-page>
          </template>
        </app-state>
      </app-state>
    </app-state-manager>


    <core-drawer-panel id="drawerPanel" narrow="{{narrow}}">
      <core-header-panel mode="scroll" drawer>
        <core-toolbar id="navheader" class="medium-tall" layout vertical>

          <place-holder id="navheader-toolbar"></place-holder>
        </core-toolbar>
        <core-menu excludedLocalNames="div">
          <core-item active icon="home" label="HOME">
            <a href="#/"></a>
          </core-item>
          <div class="separator"></div>
        </core-menu>

        <place-holder id="side" flex>
        </place-holder>
      </core-header-panel>

      <core-scroll-header-panel id="scrollheader" main condenses keepCondensedHeader>
        <core-toolbar id="mainheader" class="tall {{ {'core-narrow': narrow, 'selected-threads': selectedThreads.length} | tokenList }}">


          <paper-icon-button id="navicon" icon="menu" core-drawer-toggle></paper-icon-button>
          <div flex></div>
          <span class="bottom indent title">
              {{$.stateManager.currentState.header}}
            </span>
          <paper-button>
            <a href="#/account/signin">Sign in</a>
          </paper-button>

        </core-toolbar>
        <place-holder id="main">
        </place-holder>

      </core-scroll-header-panel>
    </core-drawer-panel>

    <paper-toast id="msg" text="State changed from {{$.stateManager.oldState.id || $.stateManager.oldState.header}} to {{$.stateManager.currentState.id || $.stateManager.currentState.header}}">
      <div style="color: #eeff41;" onclick="window.history.back()">Back?</div>
    </paper-toast>

  </template>

  <script>
    (function() {
      var strings = [
        'Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ea adipisci fuga fugiat deserunt provident natus veniam accusamus minus. Quaerat nemo voluptate similique ad quam, est eius, harum tenetur mollitia officiis!',
        'Neque porro quisquam est qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit...',
        'Lorem Ipsum is simply dummy text of the printing and typesetting industry.',
        'Quia unde, at nihil dolor veniam provident placeat assumenda suscipit autem error a sint id numquam eveniet eius, incidunt possimus obcaecati officiis!'
      ];

      var namegen = {
        generateString: function(inLength) {
          var s = '';
          for (var i = 0; i < inLength; i++) {
            s += String.fromCharCode(Math.floor(Math.random() * 26) + 97);
          }
          return s;
        },
        generateName: function(inMin, inMax) {
          return this.generateString(Math.floor(Math.random() * (inMax - inMin + 1) + inMin));
        }
      };

      Polymer({

        count: 50,

        created: function() {

        },

        generateData: function() {
          var names = [],
            surNames = [],
            data = [];
          for (var i = 0; i < this.count; i++) {
            names.push(namegen.generateName(5, 12));
            surNames.push(namegen.generateName(6, 18));
          }
          names.sort();
          for (i = 0; i < this.count; i++) {
            data.push({
              id: i + 1,
              title: names[i] + ' ' + surNames[i],
              content: strings[i % 4],
              image: i % 4,
              value: 0,
              type: 0,
              checked: false
            });
          }
          return data;
        },


        ready: function() {

          this.articles = this.generateData();
          this.stateModelBase = {
            foo: 12,
            temp: 'test string',
            alert: function(msg) {
              alert(msg);
            }
          };

          document.addEventListener('app-state-changed', function(e) {
            this.$.msg.show();
          }.bind(this));
        }

      });


    })();
  </script>

</polymer-element>
