<polymer-element name="articles-edit">
  <template>
    <paper-action-dialog id="dialog" heading="Edit article {{article.id}}" transition="core-transition-top" style="background-color: #fff;width:90%" layered="false" autoCloseDisabled>
      <form>
        <paper-input-decorator label="Title">
            <input is="core-input" value="{{article.title}}"/>
        </paper-input-decorator>

        <paper-input-decorator label="Content">
            <textarea is="core-input" value="{{article.content}}"></textarea>
        </paper-input-decorator>

    </form>

    <div>
    <h3>Do you want to login so that changes will be persisted ? <a is="app-states-anchor" stateId="signin">Click to login!</a></h3>
    </div>

    <paper-button dismissive  on-tap="{{back}}">Dismiss</paper-button>
      <paper-button affirmative autofocus on-tap="{{save}}">Save</paper-button>

    </paper-action-dialog>



  </template>
  <script>
    Polymer({

      observe: {
        'urlParams.articleId': 'getArticle'
      },

      save: function() {
        this.$.dialog.close();
        this.async(function() {
          var state = window.AppStates.manager.getStateById('articles');
          window.AppStates.manager.go(state.buildUrl());

        });
      },

      back: function() {
        this.$.dialog.close();
        this.async(function() {
          var state = window.AppStates.manager.getStateById('articles');
          window.AppStates.manager.go(state.buildUrl());

        });
      },

      ready: function() {
        this.$.dialog.open();
      },

      detached: function() {
        //this.$.dialog.close();
      },

      openDialog: function() {
        this.$.dialog.open();
      },

      getArticle: function() {
        var article = this.article = this.model.filter(function(article) {
          return article.id === this.urlParams.articleId;
        }.bind(this))[0];
      }
    });
  </script>
</polymer-element>
